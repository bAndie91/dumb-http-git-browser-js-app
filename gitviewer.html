<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Git HTTP Browser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <script src="./pako.min.js" sources="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
  <script src="./marked.min.js" sources="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: sans-serif;
    }

    header {
      padding: 0.5em;
      border-bottom: 1px solid #ccc;
      display: flex;
      gap: 0.5em;
    }

    #app {
      height: calc(100% - 42px);
    }

    .panes {
      display: flex;
      width: 100%;
      height: calc(100vh - 42px);
      overflow: hidden;
    }
    
    .panes.horizontal {
      flex-direction: row;
    }
    
    .pane {
      flex: 1 1 auto;
      display: flex;
      flex-direction: column;
      min-width: 80px;
      overflow: hidden;
      border-right: 1px solid #ccc;
      padding: 0;
    }
    
    .pane > h3 {
      flex: 0 0 auto;
      background: #eee;
      padding: 4px 8px;
      margin: 0;
      font-weight: bold;
      border-bottom: 1px solid #ccc;
      position: sticky;
      top: 0;
      z-index: 2;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .pane-inner {
      overflow: auto;
      height: 100%;
      padding: 0 0.5em;
    }
    
    .splitter {
      background: #ccc;
      z-index: 10;
    }
    
    .splitter.vertical {
      width: 6px;
      cursor: col-resize;
    }
    
    .panes.vertical {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    
    .panes.vertical > .pane {
      flex: 1;
      min-height: 50px;
      display: flex;
      flex-direction: column;
    }
    
    .splitter.horizontal {
      height: 6px;
      cursor: row-resize;
      background: #ccc;
    }
    
    .pane:last-child {
      border-right: none;
    }

    ul.dumbgitviewer, .dumbgitviewer ul {
      margin: 0;
      list-style: none;
      padding-left: 0;
    }

    .dumbgitviewer li {
      cursor: pointer;
      --list-items-horizontal-padding: 4px;
      padding: 2px var(--list-items-horizontal-padding);
    }

    .dumbgitviewer li:hover {
      background: #eee;
    }

    pre {
      white-space: pre;
      font-family: monospace;
      font-size: 0.9em;
    }

    @media (max-width: 900px) {
      .pane {
        border-right: none;
        border-bottom: 1px solid #ccc;
      }
    }
    
    .selected {
      background-color: #007acc22; /* light blue highlight */
      border-left: 3px solid #007acc; /* accent color */
      margin-left: -3px;
    }
    
    /* the long lines display mode switcher(s) */
    
    .long-lines-display-mode-switcher {
      display: flex;
      gap: 2px;
      background: #ddd;
      border-radius: 4px;
      padding: 2px;
    }

    .long-lines-display-mode-switcher button {
      background: transparent;
      border: none;
      padding: 1px 5px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 3px;
      transition: background-color 0.15s ease;
      color: #666;
    }

    .long-lines-display-mode-switcher button:hover {
      background: #ccc;
      color: #333;
    }

    .long-lines-display-mode-switcher button[aria-checked="true"] {
      background: #fff;
      color: #000;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    /* long lines display mode - panes */
    
    .pane-inner.ellipsize-long-lines ul#refs > li,
    .pane-inner.ellipsize-long-lines .commit-list-item .commit-message-subject,
    .pane-inner.ellipsize-long-lines#commitDetails *,
    .pane-inner.ellipsize-long-lines ul#tree li,
    .pane-inner.ellipsize-long-lines #file
    {
      overflow: hidden;          /* required for ellipsis */
      text-overflow: ellipsis;   /* show "â€¦" when clipped */
      white-space: nowrap;       /* prevent wrapping */
    }
    .pane-inner.ellipsize-long-lines#commitDetails .commit-message {
      white-space: pre;
    }
    .pane-inner.hscroll-long-lines   ul#refs > li,
    .pane-inner.ellipsize-long-lines .commit-list-item,
    .pane-inner.hscroll-long-lines   .commit-list-item
    {
      display: flex;
    }
    .pane-inner.hscroll-long-lines ul
    {
      width: max-content;
      min-width: 100%;
      min-width: -moz-available; /* width: stretch; */
    }
    .pane-inner.hscroll-long-lines#commitDetails .commit-message {
      white-space: pre;
    }
    .pane-inner.hscroll-long-lines ul#refs > li,
    .pane-inner.hscroll-long-lines .commit-list-item .commit-message-subject,
    .pane-inner.hscroll-long-lines#commitDetails,
    .pane-inner.hscroll-long-lines ul#tree > li,
    .pane-inner.hscroll-long-lines #file
    {
      white-space: nowrap;
    }
    .pane-inner.wrap-long-lines .commit-list-item .commit-message-subject
    {
      white-space: normal;
      word-wrap: break-word;
    }
    .pane-inner.wrap-long-lines ul#refs > li,
    .pane-inner.wrap-long-lines ul#tree > li
    {
      word-wrap: anywhere;
      text-indent: -0.5em;
      padding-inline-start: calc(0.5em + var(--list-items-horizontal-padding));
    }
    .pane-inner.wrap-long-lines .commit-list-item
    {
      display: block;
    }
    .pane-inner.wrap-long-lines#commitDetails .commit-message,
    .pane-inner.wrap-long-lines#commitDetails #file
    {
      white-space: pre-wrap;
    }
    .pane-inner.wrap-long-lines#commitDetails .commit-header-line
    {
      word-wrap: anywhere;
      text-indent: -0.5em;
      padding-inline-start: 0.5em;
    }
    .pane-inner.wrap-long-lines#commitDetails .commit-aligned-header-lines,
    .pane-inner.wrap-long-lines#commitDetails .commit-aligned-header-lines .commit-header-line
    {
      display: block;
    }
    .pane-inner.wrap-long-lines .commit-datetime
    {
      white-space: normal;
      word-wrap: unset;
    }
    
    /* end long lines display mode */
    
    .commit-datetime {
      color: #888;           /* subtle gray */
      font-size: 0.85em;     /* slightly smaller */
      white-space: nowrap;
    }
    .commit-list-item .commit-datetime {
      margin-right: 10px;     /* spacing before message */
    }
    .commit-list-item .commit-message-subject {
      color: #222;           /* primary color */
      font-weight: 500;
    }
    
    #commits-loader button {
      margin: 0.25em;
    }
    
    #commitDetails .commit-hash {
      font-family: monospace;
    }
    #commitDetails .commit-header {
      font-weight: bold;
    }
    #commitDetails .commit-message {
      margin-top: 0.75em;
    }
    #commitDetails .commit-aligned-header-lines {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 0.5em;
    }
    #commitDetails .commit-aligned-header-lines > .commit-header-line {
      display: contents;
    }
    
    .renderPOD .pod-command-unknown {
      background-color: lightgrey;
    }
    .renderPOD em {
      color: darkcyan;
    }
    .renderPOD .manpage-reference {
      text-decoration: dotted underline;
    }
    
    a[data-relative-link]::after {
      content: " ðŸ“„"; /* document icon */
      font-size: 70%;
      display: inline-block;
      vertical-align: super;
    }
    #tree li.folder::before {
      content: "ðŸ“ ";  /* folder icon */
      /* padding-inline-end: 0.3em; */
    }
    #tree li.folder.open::before {
      content: "ðŸ“‚ ";  /* open folder icon */
    }
    #tree li.folder > ul {
      display: none;
      background-color: white;
      background-color: Canvas;
      margin-left: 1em;
    }
    #tree li.folder.open > ul {
      display: block;
    }
  </style>
</head>

<body>
  <header>
    <input id="repoUrl" size="50" placeholder="https://example.com/repo.git" />
    <button id="loadRepoBtn">Load</button>
    <span id="status"></span>
  </header>

  <div id="app">
    <div id="panes-main" class="panes horizontal">
      <div id="pane-refs" class="pane" data-default-long-lines-display-mode="hscroll">
        <h3>Refs</h3>
        <div class="pane-inner">
          <ul id="refs" class="dumbgitviewer"></ul>
        </div>
      </div>
      
      <div class="splitter vertical"></div>
      
      <div class="pane">
        
        <div id="panes-column-log" class="panes vertical">
          <div id="pane-log" class="pane" data-default-long-lines-display-mode="hscroll">
            <h3>Log</h3>
            <div id="commits-loader" class="pane-inner">
              <ul id="commits" class="dumbgitviewer hscroll-long-lines"></ul>
            </div>
          </div>
          
          <div class="splitter horizontal"></div>
          
          <div id="pane-commit" class="pane" data-default-long-lines-display-mode="wrap">
            <h3>Commit</h3>
            <div id="commitDetails" class="pane-inner">
            </div>
          </div>
        </div>
      </div>
      
      <div class="splitter vertical"></div>
  
      <div id="pane-tree" class="pane" data-default-long-lines-display-mode="hscroll">
        <h3>Tree</h3>
        <div class="pane-inner">
          <ul id="tree" class="dumbgitviewer"></ul>
        </div>
      </div>
      
      <div class="splitter vertical"></div>
  
      <div id="pane-file" class="pane" data-default-long-lines-display-mode="wrap">
        <h3>File</h3>
        <div class="pane-inner">
          <div id="file"></div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./gitviewer-ui.js"></script>
  <script type="module" src="./gitviewer.js"></script>

  <template id="long-lines-display-mode-switcher">
     <div class="long-lines-display-mode-switcher" role="radiogroup" aria-label="Text display mode">
       <button role="radio" aria-checked="false" data-mode="ellipsize" title="Ellipsize long lines">â€¦</button>
       <button role="radio" aria-checked="true" data-mode="hscroll" title="Scroll long lines">â‡„</button>
       <button role="radio" aria-checked="false" data-mode="wrap" title="Wrap long lines">â†µ</button>
     </div>
  </template>
  
  <template id="commit-list-item-template">
    <li class="commit-list-item">
    	<span class="commit-datetime"></span>
    	<span class="commit-message-subject"></span>
    </li>
  </template>

  <template id="commit-details-template">
    <div class="commit-headers">
      <div class="commit-header-line commit-hash-line">
        <span class="commit-header">commit</span>
        <span class="commit-hash"></span>
      </div>
      
      <div class="commit-author-equal-committer">
        <div class="commit-header-line commit-author-line">
          <span class="commit-header">Author:</span>
          <span class="commit-author-identity">
            <span class="commit-author-name"></span>
            <span class="commit-author-email"></span>
          </span>
        </div>
      </div>
      
      <div class="commit-author-differ-committer commit-aligned-header-lines">
        <div class="commit-header-line commit-author-line">
          <span class="commit-header">Author:</span>
          <span class="commit-author-identity">
            <span class="commit-author-name"></span>
            <span class="commit-author-email"></span>
          </span>
        </div>
        
        <div class="commit-header-line commit-committer-line">
          <span class="commit-header">Committer:</span>
          <span class="commit-committer-identity">
            <span class="commit-committer-name"></span>
            <span class="commit-committer-email"></span>
          </span>
        </div>
      </div>
      
      <div class="commit-author-date-equal-committer-date">
        <div class="commit-header-line commit-date-line commit-author-date-line">
          <span class="commit-header">Date:</span>
          <span class="commit-author-datetime commit-datetime"></span>
        </div>
      </div>
      
      <div class="commit-author-date-differ-committer-date commit-aligned-header-lines">
        <div class="commit-header-line commit-date-line commit-author-date-line">
          <span class="commit-header">Authored Date:</span>
          <span class="commit-author-datetime commit-datetime"></span>
        </div>
      
        <div class="commit-header-line commit-date-line commit-commit-date-line">
          <span class="commit-header">Commit Date:</span>
          <span class="commit-commit-datetime commit-datetime"></span>
        </div>
      </div>
    </div>
    <div class="commit-message"></div>
  </template>
</body>
</html>
